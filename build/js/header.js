const loaderContainer=document.getElementById("loader-container"),overlay=document.getElementById("overlay"),selectCity=document.getElementById("select_city"),cardCity=document.getElementById("city-card"),ccbSelectCity=document.getElementById("ccb-select-city"),ccbTags=document.getElementById("ccb-tags"),cardCityBtn=document.getElementById("card-city-btn"),inputSearchCity=document.getElementById("input-search-city"),ccbInputImg=document.getElementById("ccb-input-img"),areas=document.getElementById("ccb-select-city");var arrowCity,tagsItem,arrowCountry=[],sendArrowCountry=[],arrowTags=[],newArrowTags=[],loaderCity=!1,textInput=[];const apiCountry=async()=>{await fetch("https://studika.ru/api/areas",{method:"POST"}).then(e=>{200!==e.status?console.log("Проблема загрузки городов. Статус: "+e.status):e.json().then(e=>{sendArrowCountry=arrowCountry=e})}).catch(e=>{console.log("e",e)})},clicks=()=>{selectCity.addEventListener("click",()=>{cardCity.style.display="flex",overlay.style.display="block",eachInner()}),overlay.addEventListener("click",()=>{cardCity.style.display="none",overlay.style.display="none"}),cardCityBtn.addEventListener("click",e=>{arrowTags.forEach(t=>{sendArrowCountry.filter(e=>{e.name==t&&newArrowTags.push(e)}),document.cookie+="city="+JSON.stringify(newArrowTags),console.log(document.cookie)}),cardCity.style.display="none",overlay.style.display="none"}),inputSearchCity.addEventListener("click",e=>{ccbInputImg.style.display="block",inputSearchCity.oninput=async e=>{textInput=e.target.value,arrowCountry=arrowCountry.filter(e=>{if(e.name.toLowerCase().includes(textInput.toLowerCase()))return e.name}),areas.innerHTML="",arrowCountry.forEach(e=>{areas.innerHTML+=`
                      <div id="arrow-city" class="arrow-city">
                     ${e.name}
                       </div>`,arrowCity=document.querySelectorAll("#arrow-city")}),startApp(),await apiCountry()}}),ccbInputImg.addEventListener("click",async e=>{inputSearchCity.value="",areas.innerHTML="",arrowCountry.forEach(e=>{areas.innerHTML+=`
                    <div id="arrow-city" class="arrow-city">
                   ${e.name}
                     </div>`,arrowCity=document.querySelectorAll("#arrow-city")}),startApp(),await apiCountry(),console.log("text input close",inputSearchCity.value)})},eachInner=()=>{try{console.log("areas",areas.children.length);const e=()=>{console.log("start"),areas.children.length<=0&&(arrowCountry.forEach(e=>{areas.innerHTML+=`
                                <div id="arrow-city" class="arrow-city">
                               ${e.name}
                                 </div>`,arrowCity=document.querySelectorAll("#arrow-city"),loaderCity=!0}),startApp())};loaderCity?e():(loaderContainer.style.display="flex",ccbSelectCity.style.display="none",setTimeout(()=>{e(),loaderContainer.style.display="none",ccbSelectCity.style.display="block"},500))}catch(e){console.log("e",e)}},clickSetCity=()=>{arrowCity.forEach(e=>{e.addEventListener("click",e=>{let t=e.target.childNodes[0].data.trim();arrowTags.includes(t)?(arrowTags=arrowTags.filter(e=>e!==t),console.log("удалил тег",arrowTags.length)):(arrowTags.push(t),console.log("Добавил тег",arrowTags.length)),tagsInner()})})},tagsInner=()=>{try{ccbTags.innerHTML="",arrowTags.forEach(e=>{ccbTags.innerHTML+=`
          <div id="tags-item" class="tags-item">
                    <span class="tags-item-span">${e}</span>
                    <img class="tags-item-img" src="/img/header/close.svg" alt="" />
                  </div>  `}),1<=arrowTags.length?cardCityBtn.children[0].disabled=!1:arrowTags.length<=0&&(cardCityBtn.children[0].disabled=!0),clickRemoveTags()}catch(e){console.log("e",e)}},clickRemoveTags=()=>{(tagsItem=document.querySelectorAll("#tags-item")).forEach(a=>{a.addEventListener("click",e=>{if("img"===e.target.localName){const t=e.target.nextSibling.parentElement.children[0].innerText;arrowTags=arrowTags.filter(e=>e.trim()!==t.trim()),tagsInner()}else"span"===e.target.localName&&(a.style.background="wheat")})})},startApp=async()=>{arrowCountry.length<=0&&await apiCountry(),loaderCity&&clickSetCity()};startApp(),clicks();